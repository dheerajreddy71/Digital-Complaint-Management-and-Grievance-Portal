# Technical Assumptions & Design Decisions

This document outlines the key assumptions and design decisions made during the development of the Digital Complaint Management & Grievance Portal.

---

## 1. Authentication & Authorization

### Assumptions

1. **Single Sign-On (SSO)**: Not required for initial release. Standard email/password authentication is sufficient.

2. **Password Policy**: 
   - Minimum 8 characters
   - At least one uppercase, one lowercase, one number, one special character
   - No password history enforcement initially

3. **Session Management**:
   - Access tokens expire in 30 minutes
   - Refresh tokens expire in 7 days
   - Tokens stored in memory (access) and httpOnly cookies (refresh)

4. **Role Hierarchy**:
   - `citizen` < `staff` < `admin`
   - Staff cannot modify other staff or admin accounts
   - Admin has full system access

### Design Decisions

- **JWT over Sessions**: Chose JWT for stateless authentication, enabling horizontal scaling without session store synchronization.

- **Refresh Token Rotation**: Each refresh generates a new refresh token, invalidating the old one for security.

- **No OAuth Initially**: Social login (Google, Facebook) deferred to future release due to time constraints.

---

## 2. Database Design

### Assumptions

1. **Single Database Instance**: No sharding or partitioning required for initial scale (< 100K users).

2. **Read/Write Ratio**: Estimated 80% reads, 20% writes. Optimized indexes for read-heavy operations.

3. **Soft Deletes**: Users are never physically deleted; `is_active` flag used instead for audit compliance.

4. **JSON for Attachments**: File paths stored as JSON array in complaints table rather than separate junction table.

### Design Decisions

- **MySQL over PostgreSQL**: MySQL chosen for familiarity and ecosystem support. PostgreSQL's advanced features (arrays, JSONB) not critical for this use case.

- **No ORM**: Direct SQL with mysql2 driver used for:
  - Full control over queries
  - Better performance
  - No abstraction overhead
  - Simple enough schema doesn't need migration tools

- **Indexing Strategy**:
  - `complaints(citizen_id, status)` - Dashboard queries
  - `complaints(assigned_to, status)` - Staff workqueue
  - `complaints(created_at)` - Sorting
  - `notifications(user_id, is_read)` - Unread count

- **Timestamps**: All tables use `created_at` and `updated_at` with automatic updates.

---

## 3. API Design

### Assumptions

1. **RESTful API**: Standard REST conventions are sufficient; GraphQL not needed.

2. **Versioning**: No API versioning initially (`/api/` without version). Will add `/api/v2/` when breaking changes needed.

3. **Response Format**: Consistent JSON structure:
   ```json
   {
     "success": boolean,
     "data": object | array,
     "message": string,
     "pagination": object
   }
   ```

4. **Error Codes**: HTTP status codes used correctly:
   - 200: Success
   - 201: Created
   - 400: Bad Request (validation)
   - 401: Unauthorized
   - 403: Forbidden
   - 404: Not Found
   - 429: Rate Limited
   - 500: Server Error

### Design Decisions

- **No HATEOAS**: Hypermedia links not included in responses to reduce payload size.

- **Pagination**: Offset-based pagination (`page`, `limit`) used over cursor-based for simplicity. May switch to cursor for large datasets.

- **Filtering**: Query parameters for filtering (`?status=pending&priority=high`). No advanced query language.

- **Rate Limiting**: 
  - 100 requests per 15 minutes for general API
  - 5 requests per minute for authentication endpoints
  - Sliding window algorithm

---

## 4. Frontend Architecture

### Assumptions

1. **Browser Support**: 
   - Chrome/Edge (last 2 versions)
   - Firefox (last 2 versions)
   - Safari (last 2 versions)
   - No IE11 support

2. **JavaScript Required**: Progressive enhancement not implemented; JavaScript required for all functionality.

3. **Mobile First**: Primary design target is mobile (375px width), then scale up.

### Design Decisions

- **Angular 16**: Chosen for:
  - Strong TypeScript integration
  - Angular Material for consistent UI
  - RxJS for reactive programming
  - Dependency injection for testability
  - Lazy loading for performance

- **Feature Modules**: Each feature is a lazy-loaded module:
  - `auth` - Login, register
  - `dashboard` - Role-based dashboards
  - `complaints` - CRUD operations
  - `admin` - Admin management
  - `staff` - Staff workqueue
  - `notifications` - Notification center
  - `profile` - User settings

- **State Management**: No NgRx/Redux. Using:
  - BehaviorSubjects for global state (auth, notifications)
  - Component state for local data
  - Service caching for API responses

- **Inline Components**: Templates and styles kept inline for:
  - Faster development
  - Easier refactoring
  - Better AI assistance
  - Single file per component

---

## 5. File Handling

### Assumptions

1. **File Types Allowed**:
   - Images: JPEG, PNG, GIF, WebP
   - Documents: PDF, DOC, DOCX
   - Maximum 5 files per complaint

2. **File Size Limit**: 10MB per file, configurable via environment variable.

3. **Storage**: Local filesystem initially. Cloud storage (S3) in production.

### Design Decisions

- **Multer for Uploads**: Express middleware for multipart form handling.

- **File Naming**: UUID-based naming to prevent conflicts and directory traversal attacks.

- **No Image Processing**: Images stored as-is. Thumbnail generation deferred to future.

- **Static Serving**: Nginx serves `/uploads/` directory directly in production.

---

## 6. SLA Management

### Assumptions

1. **SLA Calculation**: Based on complaint priority:
   - Critical: 24 hours
   - High: 48 hours
   - Medium: 72 hours
   - Low: 168 hours (7 days)

2. **Business Hours**: SLA calculated as calendar time, not business hours.

3. **SLA Reset**: SLA deadline does not reset on status changes.

### Design Decisions

- **Scheduled Jobs**: Node-cron runs every hour to:
  - Check for approaching SLA deadlines
  - Mark complaints as overdue
  - Send reminder notifications

- **Overdue Handling**: Complaints exceeding SLA are flagged but not auto-escalated initially.

---

## 7. Notifications

### Assumptions

1. **In-App Only**: No email/SMS notifications in initial release.

2. **Push Notifications**: Browser push notifications optional, requires user consent.

3. **Real-Time Updates**: Polling-based (30-second interval), not WebSocket.

### Design Decisions

- **Notification Types**:
  - `complaint_created` - Citizen
  - `complaint_assigned` - Staff
  - `status_updated` - Citizen
  - `comment_added` - Both
  - `sla_warning` - Staff/Admin
  - `sla_breach` - Staff/Admin

- **No Email Integration**: SMTP configured but email sending not implemented. Notifications table ready for email queue.

---

## 8. Security

### Assumptions

1. **HTTPS Required**: Application assumes HTTPS in production (handled by nginx/load balancer).

2. **CORS**: Configured for specific origins in production.

3. **SQL Injection**: Prevented via parameterized queries.

4. **XSS**: Angular's built-in sanitization + Content-Security-Policy headers.

### Design Decisions

- **Password Hashing**: bcrypt with 12 salt rounds. Slower but more secure.

- **Rate Limiting**: In-memory store initially. Redis-backed in production for distributed rate limiting.

- **Input Validation**: Server-side validation mandatory. Client-side for UX only.

- **Audit Logging**: All state-changing operations logged with:
  - User ID
  - Action type
  - Entity affected
  - Old/new values (JSON)
  - IP address
  - User agent

---

## 9. Performance

### Assumptions

1. **Expected Load**:
   - 1,000 concurrent users
   - 10,000 complaints per month
   - 100,000 page views per month

2. **Response Time Target**: 95th percentile < 500ms for API responses.

### Design Decisions

- **Connection Pooling**: MySQL pool with 10 connections minimum, 50 maximum.

- **No Caching Initially**: Direct database queries. Redis caching for frequently accessed data in future.

- **Pagination**: Default 10 items, maximum 50 items per page.

- **Eager Loading**: Related data (user, comments) loaded in single query where appropriate.

---

## 10. Deployment

### Assumptions

1. **Docker-Based**: All components containerized.

2. **Single Server Initially**: All services on one server for MVP. Horizontal scaling later.

3. **Environment Variables**: All configuration via environment variables, no config files.

### Design Decisions

- **Multi-Stage Docker Builds**: Smaller production images (build vs runtime).

- **Health Checks**: `/api/health` endpoint for container orchestration.

- **Graceful Shutdown**: Handle SIGTERM for clean database disconnection.

- **No Blue-Green**: Rolling updates acceptable for initial release.

---

## 11. Testing

### Assumptions

1. **Test Coverage Target**: 70% code coverage minimum.

2. **E2E Tests**: Critical paths only (login, complaint submission, status update).

### Design Decisions

- **Unit Tests**: Jest for backend, Jasmine/Karma for frontend.

- **Integration Tests**: Supertest for API endpoint testing.

- **No Snapshot Testing**: Component templates too volatile.

---

## 12. Limitations & Future Considerations

### Current Limitations

1. **No Offline Support**: PWA capabilities not implemented.

2. **Single Language**: English only. i18n infrastructure not in place.

3. **No Export**: Data export (CSV, PDF) not implemented.

4. **No Bulk Operations**: Single complaint operations only.

5. **No Custom Workflows**: Fixed status progression.

6. **No Department Routing**: Flat assignment, no department hierarchy.

### Future Roadmap

| Feature | Priority | Estimated Effort |
|---------|----------|------------------|
| Email Notifications | High | 2 weeks |
| WebSocket Real-time | High | 1 week |
| PDF Report Generation | Medium | 1 week |
| Multi-language (i18n) | Medium | 2 weeks |
| Mobile App (Ionic) | Medium | 4 weeks |
| AI Auto-categorization | Low | 3 weeks |
| Bulk Status Updates | Low | 1 week |
| Department Workflows | Low | 3 weeks |
| OAuth (Google/Facebook) | Low | 1 week |

---

## 13. Third-Party Dependencies

### Backend Dependencies

| Package | Version | Purpose | License |
|---------|---------|---------|---------|
| express | ^4.18.2 | Web framework | MIT |
| mysql2 | ^3.6.5 | MySQL driver | MIT |
| jsonwebtoken | ^9.0.2 | JWT handling | MIT |
| bcrypt | ^5.1.1 | Password hashing | MIT |
| multer | ^1.4.5 | File uploads | MIT |
| node-cron | ^3.0.3 | Scheduled jobs | ISC |
| winston | ^3.11.0 | Logging | MIT |
| uuid | ^9.0.1 | ID generation | MIT |

### Frontend Dependencies

| Package | Version | Purpose | License |
|---------|---------|---------|---------|
| @angular/core | ^16.2.0 | Framework | MIT |
| @angular/material | ^16.2.0 | UI components | MIT |
| rxjs | ^7.8.0 | Reactive programming | Apache-2.0 |

### No Critical Dependencies

All dependencies are:
- Actively maintained
- Well-documented
- Widely used in production
- MIT or compatible license

---

## 14. Naming Conventions

### Code

| Element | Convention | Example |
|---------|------------|---------|
| Files | kebab-case | `complaint-detail.component.ts` |
| Classes | PascalCase | `ComplaintService` |
| Methods | camelCase | `getComplaintById()` |
| Variables | camelCase | `complaintList` |
| Constants | UPPER_SNAKE | `MAX_FILE_SIZE` |
| Interfaces | PascalCase with I prefix | `IComplaint` or no prefix |
| Types | PascalCase | `ComplaintStatus` |

### Database

| Element | Convention | Example |
|---------|------------|---------|
| Tables | snake_case | `status_history` |
| Columns | snake_case | `created_at` |
| Primary Key | `id` | `id` |
| Foreign Key | `{table}_id` | `citizen_id` |
| Boolean | `is_{condition}` | `is_active` |

### API

| Element | Convention | Example |
|---------|------------|---------|
| Endpoints | kebab-case | `/api/audit-logs` |
| Query params | camelCase | `?sortOrder=desc` |
| Request body | camelCase | `{ citizenId: 1 }` |
| Response body | snake_case | `{ citizen_id: 1 }` |

---

## Conclusion

These assumptions and decisions were made to:
1. Deliver an MVP quickly
2. Maintain code quality and security
3. Enable future scaling and enhancement
4. Keep the codebase maintainable

All decisions are documented here for transparency and to guide future development.
